<!DOCTYPE html>
<html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1.0"/><title>Tutorial - Graphene</title><link rel="shortcut icon" href="/favicon.png"/><link href="https://fonts.googleapis.com/css?family=Raleway:400,600,200,100" rel="stylesheet" type="text/css"/><link href="/app.css" rel="stylesheet" type="text/css"/></head><body><div id="react-mount"><div data-reactid=".graphene" data-react-checksum="-1086126672"><div data-reactid=".graphene.0"><div class="bm-overlay" style="position:fixed;z-index:1;width:100%;height:100%;background:rgba(0, 0, 0, 0.3);opacity:0;transform:translate3d(-100%, 0, 0);transition:opacity 0.3s, transform 0s 0.3s;" data-reactid=".graphene.0.$/=10"></div><div id="" class="bm-menu-wrap" style="position:fixed;right:0;z-index:2;width:200px;height:100%;transform:translate3d(220px, 0, 0);transition:transform 0.4s cubic-bezier(0.7, 0, 0.3, 1);" data-reactid=".graphene.0.$/=11"><div class="bm-menu" style="height:100%;box-sizing:border-box;" data-reactid=".graphene.0.$/=11.$/=11"><nav class="bm-item-list" style="height:100%;" data-reactid=".graphene.0.$/=11.$/=11.0"><span style="display:block;outline:none;transform:translate3d(0, 500px, 0);transition:transform 0s 0.2s cubic-bezier(0.7, 0, 0.3, 1);" data-reactid=".graphene.0.$/=11.$/=11.0.$0//=10/=1$0/=010"><a href="/playground/" data-reactid=".graphene.0.$/=11.$/=11.0.$0//=10/=1$0/=010.0">Try it out</a></span><span style="display:block;outline:none;transform:translate3d(0, 1000px, 0);transition:transform 0s 0.2s cubic-bezier(0.7, 0, 0.3, 1);" data-reactid=".graphene.0.$/=11.$/=11.0.$1//=11/=1$1/=011"><a class="active" href="/docs/quickstart/" data-reactid=".graphene.0.$/=11.$/=11.0.$1//=11/=1$1/=011.0">Docs</a></span><span style="display:block;outline:none;transform:translate3d(0, 1500px, 0);transition:transform 0s 0.2s cubic-bezier(0.7, 0, 0.3, 1);" data-reactid=".graphene.0.$/=11.$/=11.0.$2//=12/=1$2/=012"><a class="" href="/community/" data-reactid=".graphene.0.$/=11.$/=11.0.$2//=12/=1$2/=012.0">Community</a></span><a href="https://github.com/graphql-python/graphene/" style="display:block;outline:none;transform:translate3d(0, 2000px, 0);transition:transform 0s 0.2s cubic-bezier(0.7, 0, 0.3, 1);" data-reactid=".graphene.0.$/=11.$/=11.0.$3//=13/=1$3/=013">Github</a></nav></div><div data-reactid=".graphene.0.$/=11.$=12"><div data-reactid=".graphene.0.$/=11.$=12.0"><span class="bm-cross" style="position:absolute;width:3px;height:14px;top:14px;right:18px;cursor:pointer;transform:rotate(45deg);z-index:1;" data-reactid=".graphene.0.$/=11.$=12.0.$/=10"></span><span class="bm-cross" style="position:absolute;width:3px;height:14px;top:14px;right:18px;cursor:pointer;transform:rotate(-45deg);z-index:1;" data-reactid=".graphene.0.$/=11.$=12.0.$/=11"></span><button style="width:14px;height:14px;position:absolute;right:13px;top:14px;padding:0;overflow:hidden;text-indent:14px;font-size:14px;border:none;background:transparent;color:transparent;outline:none;z-index:1;" data-reactid=".graphene.0.$/=11.$=12.0.$/=12">Close Menu</button></div></div></div><div class="bm-burger-button" style="z-index:1;" data-reactid=".graphene.0.$=12"><span data-reactid=".graphene.0.$=12.$/=10"><span class="bm-burger-bars" style="position:absolute;height:20%;left:0;right:0;top:0%;opacity:1;" data-reactid=".graphene.0.$=12.$/=10.$/=10"></span><span class="bm-burger-bars" style="position:absolute;height:20%;left:0;right:0;top:40%;opacity:1;" data-reactid=".graphene.0.$=12.$/=10.$/=11"></span><span class="bm-burger-bars" style="position:absolute;height:20%;left:0;right:0;top:80%;opacity:1;" data-reactid=".graphene.0.$=12.$/=10.$/=12"></span></span><button style="position:absolute;left:0;right:0;top:0;bottom:0;margin:0;padding:0;border:none;font-size:14px;color:transparent;background:transparent;outline:none;" data-reactid=".graphene.0.$=12.$/=11">Open Menu</button></div></div><header class="header" data-reactid=".graphene.1"><div class="header-wrapper" data-reactid=".graphene.1.0"><a class="header-logo" href="/" data-reactid=".graphene.1.0.0"><span data-reactid=".graphene.1.0.0.0"><svg width="100%" height="100%" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" class="logo"><g fill="none" fill-rule="evenodd"><path class="logo-path" d="M49.17 10.915L15.415 30.29l.058 39.252 34.633 20.082 33.345-18.95-.023-39.79-34.185 19.238" stroke="white" stroke-width="4.987"/>
    <g transform="translate(41.5 3)"><ellipse cx="7.934" cy="7.97" rx="7.934" ry="7.97" fill="white"/></g>
    <g transform="translate(8 22.482)"><ellipse cx="7.934" cy="7.97" rx="7.934" ry="7.97" fill="white"/></g>
    <g transform="translate(8 62.33)"><ellipse cx="7.934" cy="7.97" rx="7.934" ry="7.97" fill="white"/></g>
    <g transform="translate(42.382 81.813)"><ellipse cx="7.934" cy="7.97" rx="7.934" ry="7.97" fill="white"/></g>
    <g transform="translate(75.882 62.33)"><ellipse cx="7.934" cy="7.97" rx="7.934" ry="7.97" fill="white"/></g>
    <g transform="translate(75.882 22.482)"><ellipse cx="7.934" cy="7.97" rx="7.934" ry="7.97" fill="white"/></g>
    <g transform="translate(42.382 41.964)"><ellipse cx="7.934" cy="7.97" rx="7.934" ry="7.97" fill="white"/></g>
    </g>
</svg>
</span><span data-reactid=".graphene.1.0.0.1">Graphene</span></a><nav class="header-nav" data-reactid=".graphene.1.0.1"><a href="/playground/" data-reactid=".graphene.1.0.1.0">Try it out</a><a class="active" href="/docs/quickstart/" data-reactid=".graphene.1.0.1.1">Docs</a><a class="" href="/community/" data-reactid=".graphene.1.0.1.2">Community</a><a href="https://github.com/graphql-python/graphene/" data-reactid=".graphene.1.0.1.3">Github</a></nav></div></header><div data-reactid=".graphene.2"><div class="page-title" data-reactid=".graphene.2.0"><h1 data-reactid=".graphene.2.0.0">Documentation</h1></div><div class="docs" data-reactid=".graphene.2.1"><aside class="docs-aside" data-reactid=".graphene.2.1.0"><div class="docs-aside-group" data-reactid=".graphene.2.1.0.0:$quickstart"><h3 data-reactid=".graphene.2.1.0.0:$quickstart.0">Quickstart</h3><a class="" href="/docs/quickstart/" data-reactid=".graphene.2.1.0.0:$quickstart.1:$/docs/quickstart/">Getting started</a></div><div class="docs-aside-group" data-reactid=".graphene.2.1.0.0:$walkthrough"><h3 data-reactid=".graphene.2.1.0.0:$walkthrough.0">Walkthrough</h3><a class="" href="/docs/interfaces/" data-reactid=".graphene.2.1.0.0:$walkthrough.1:$/docs/interfaces/">Interfaces</a><a class="" href="/docs/objecttypes/" data-reactid=".graphene.2.1.0.0:$walkthrough.1:$/docs/objecttypes/">ObjectTypes</a><a class="" href="/docs/resolvers/" data-reactid=".graphene.2.1.0.0:$walkthrough.1:$/docs/resolvers/">Resolvers</a><a class="" href="/docs/mutations/" data-reactid=".graphene.2.1.0.0:$walkthrough.1:$/docs/mutations/">Mutations</a><a class="" href="/docs/basic-types/" data-reactid=".graphene.2.1.0.0:$walkthrough.1:$/docs/basic-types/">Basic Types</a><a class="" href="/docs/enums/" data-reactid=".graphene.2.1.0.0:$walkthrough.1:$/docs/enums/">Enums</a><a class="" href="/docs/relay/" data-reactid=".graphene.2.1.0.0:$walkthrough.1:$/docs/relay/">Relay</a><a class="" href="/docs/middleware/" data-reactid=".graphene.2.1.0.0:$walkthrough.1:$/docs/middleware/">Middleware</a></div><div class="docs-aside-group" data-reactid=".graphene.2.1.0.0:$django"><h3 data-reactid=".graphene.2.1.0.0:$django.0">Django</h3><a class="" href="/docs/django/tutorial/" data-reactid=".graphene.2.1.0.0:$django.1:$/docs/django/tutorial/">Quickstart</a><a class="" href="/docs/django/filtering/" data-reactid=".graphene.2.1.0.0:$django.1:$/docs/django/filtering/">Filtering</a><a class="" href="/docs/django/authorization/" data-reactid=".graphene.2.1.0.0:$django.1:$/docs/django/authorization/">Authorization</a><a class="" href="/docs/django/introspection-schema/" data-reactid=".graphene.2.1.0.0:$django.1:$/docs/django/introspection-schema/">Introspection Schema</a><a class="" href="/docs/django/debug/" data-reactid=".graphene.2.1.0.0:$django.1:$/docs/django/debug/">Django Debug Plugin</a></div><div class="docs-aside-group" data-reactid=".graphene.2.1.0.0:$sqlalchemy"><h3 data-reactid=".graphene.2.1.0.0:$sqlalchemy.0">SQLAlchemy</h3><a class=" active" href="/docs/sqlalchemy/tutorial/" data-reactid=".graphene.2.1.0.0:$sqlalchemy.1:$/docs/sqlalchemy/tutorial/">Tutorial</a><a class="" href="/docs/sqlalchemy/tips/" data-reactid=".graphene.2.1.0.0:$sqlalchemy.1:$/docs/sqlalchemy/tips/">Tips</a></div><select class="docs-aside-navselect" data-reactid=".graphene.2.1.0.1"><optgroup label="Quickstart" data-reactid=".graphene.2.1.0.1.$quickstart"><option value="/docs/quickstart/" data-reactid=".graphene.2.1.0.1.$quickstart.$/docs/quickstart/">Getting started</option></optgroup><optgroup label="Walkthrough" data-reactid=".graphene.2.1.0.1.$walkthrough"><option value="/docs/interfaces/" data-reactid=".graphene.2.1.0.1.$walkthrough.$/docs/interfaces/">Interfaces</option><option value="/docs/objecttypes/" data-reactid=".graphene.2.1.0.1.$walkthrough.$/docs/objecttypes/">ObjectTypes</option><option value="/docs/resolvers/" data-reactid=".graphene.2.1.0.1.$walkthrough.$/docs/resolvers/">Resolvers</option><option value="/docs/mutations/" data-reactid=".graphene.2.1.0.1.$walkthrough.$/docs/mutations/">Mutations</option><option value="/docs/basic-types/" data-reactid=".graphene.2.1.0.1.$walkthrough.$/docs/basic-types/">Basic Types</option><option value="/docs/enums/" data-reactid=".graphene.2.1.0.1.$walkthrough.$/docs/enums/">Enums</option><option value="/docs/relay/" data-reactid=".graphene.2.1.0.1.$walkthrough.$/docs/relay/">Relay</option><option value="/docs/middleware/" data-reactid=".graphene.2.1.0.1.$walkthrough.$/docs/middleware/">Middleware</option></optgroup><optgroup label="Django" data-reactid=".graphene.2.1.0.1.$django"><option value="/docs/django/tutorial/" data-reactid=".graphene.2.1.0.1.$django.$/docs/django/tutorial/">Quickstart</option><option value="/docs/django/filtering/" data-reactid=".graphene.2.1.0.1.$django.$/docs/django/filtering/">Filtering</option><option value="/docs/django/authorization/" data-reactid=".graphene.2.1.0.1.$django.$/docs/django/authorization/">Authorization</option><option value="/docs/django/introspection-schema/" data-reactid=".graphene.2.1.0.1.$django.$/docs/django/introspection-schema/">Introspection Schema</option><option value="/docs/django/debug/" data-reactid=".graphene.2.1.0.1.$django.$/docs/django/debug/">Django Debug Plugin</option></optgroup><optgroup label="SQLAlchemy" data-reactid=".graphene.2.1.0.1.$sqlalchemy"><option selected="" value="/docs/sqlalchemy/tutorial/" data-reactid=".graphene.2.1.0.1.$sqlalchemy.$/docs/sqlalchemy/tutorial/">Tutorial</option><option value="/docs/sqlalchemy/tips/" data-reactid=".graphene.2.1.0.1.$sqlalchemy.$/docs/sqlalchemy/tips/">Tips</option></optgroup></select></aside><div class="docs-content" data-reactid=".graphene.2.1.1"><div data-reactid=".graphene.2.1.1.0"><div class="markdown" data-reactid=".graphene.2.1.1.0.1"><div data-reactid=".graphene.2.1.1.0.1.0"><h1>SQLAlchemy + Flask Tutorial</h1>
<p>Graphene comes with builtin support to SQLAlchemy, which makes quite easy to operate with your current models.</p>
<p><strong>Note: The code in this tutorial is pulled from the
<a href="https://github.com/graphql-python/graphene/tree/master/examples/flask_sqlalchemy">Flask SQLAlchemy example app</a></strong>.</p>
<h2>Setup the Project</h2>
<p>We will setup the project, execute the following:</p>
<pre><code class="language-bash"><span class="hljs-comment"># Create the project directory</span>
mkdir flask_sqlalchemy
<span class="hljs-built_in">cd</span> flask_sqlalchemy

<span class="hljs-comment"># Create a virtualenv to isolate our package dependencies locally</span>
virtualenv env
<span class="hljs-built_in">source</span> env/bin/activate  <span class="hljs-comment"># On Windows use `env\Scripts\activate`</span>

<span class="hljs-comment"># SQLAlchemy and Graphene with SQLAlchemy support</span>
pip install SQLAlchemy
pip install graphene[sqlalchemy]

<span class="hljs-comment"># Install Flask and GraphQL Flask for exposing the schema through HTTP</span>
pip install Flask
pip install Flask-GraphQL
</code></pre>
<h2>Defining our models</h2>
<p>Let’s get started with these models:</p>
<pre><code class="language-python"><span class="hljs-comment"># flask_sqlalchemy/models.py</span>
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> (scoped_session, sessionmaker, relationship,
                            backref)
<span class="hljs-keyword">from</span> sqlalchemy.ext.declarative <span class="hljs-keyword">import</span> declarative_base

engine = create_engine(<span class="hljs-string">'sqlite:///database.sqlite3'</span>, convert_unicode=<span class="hljs-keyword">True</span>)
db_session = scoped_session(sessionmaker(autocommit=<span class="hljs-keyword">False</span>,
                                         autoflush=<span class="hljs-keyword">False</span>,
                                         bind=engine))

Base = declarative_base()
<span class="hljs-comment"># We will need this for querying</span>
Base.query = db_session.query_property()


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Department</span><span class="hljs-params">(Base)</span>:</span>
    __tablename__ = <span class="hljs-string">'department'</span>
    id = Column(Integer, primary_key=<span class="hljs-keyword">True</span>)
    name = Column(String)


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Employee</span><span class="hljs-params">(Base)</span>:</span>
    __tablename__ = <span class="hljs-string">'employee'</span>
    id = Column(Integer, primary_key=<span class="hljs-keyword">True</span>)
    name = Column(String)
    hired_on = Column(DateTime, default=func.now())
    department_id = Column(Integer, ForeignKey(<span class="hljs-string">'department.id'</span>))
    department = relationship(
        Department,
        backref=backref(<span class="hljs-string">'employees'</span>,
                        uselist=<span class="hljs-keyword">True</span>,
                        cascade=<span class="hljs-string">'delete,all'</span>))
</code></pre>
<h2>Schema</h2>
<p>GraphQL presents your objects to the world as a graph structure rather than a more
hierarchical structure to which you may be accustomed. In order to create this
representation, Graphene needs to know about each <em>type</em> of object which will appear in
the graph.</p>
<p>This graph also has a <em>root type</em> through which all access begins. This is the <code>Query</code> class below.
In this example, we provide the ability to list all employees via <code>all_employees</code>, and the
ability to obtain a specific node via <code>node</code>.</p>
<p>Create <code>flask_sqlalchemy/schema.py</code> and type the following:</p>
<pre><code class="language-python"><span class="hljs-comment"># flask_sqlalchemy/schema.py</span>
<span class="hljs-keyword">import</span> graphene
<span class="hljs-keyword">from</span> graphene <span class="hljs-keyword">import</span> relay
<span class="hljs-keyword">from</span> graphene.contrib.sqlalchemy <span class="hljs-keyword">import</span> SQLAlchemyNode, SQLAlchemyConnectionField
<span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> db_session, Department <span class="hljs-keyword">as</span> DepartmentModel, Employee <span class="hljs-keyword">as</span> EmployeeModel

schema = graphene.Schema()


<span class="hljs-decorator">@schema.register</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Department</span><span class="hljs-params">(SQLAlchemyNode)</span>:</span>
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        model = DepartmentModel


<span class="hljs-decorator">@schema.register</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Employee</span><span class="hljs-params">(SQLAlchemyNode)</span>:</span>
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span>
        model = EmployeeModel


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Query</span><span class="hljs-params">(graphene.ObjectType)</span>:</span>
    node = relay.NodeField()
    all_employees = SQLAlchemyConnectionField(Employee)

schema.query = Query
</code></pre>
<h2>Creating GraphQL and GraphiQL views in Flask</h2>
<p>Unlike a RESTful API, there is only a single URL from which GraphQL is accessed.</p>
<p>We are going to use Flask to create a server that expose the GraphQL schema under <code>/graphql</code> and a interface for querying it easily: GraphiQL under <code>/graphiql</code>.</p>
<p>Fortunately for us, the library <code>Flask-GraphQL</code> that we previously installed makes this task quite easy.</p>
<pre><code class="language-python"><span class="hljs-comment"># flask_sqlalchemy/app.py</span>
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask
<span class="hljs-keyword">from</span> flask_graphql <span class="hljs-keyword">import</span> GraphQL

<span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> db_session
<span class="hljs-keyword">from</span> schema <span class="hljs-keyword">import</span> schema, Department

app = Flask(__name__)
app.debug = <span class="hljs-keyword">True</span>

<span class="hljs-comment"># This is creating the `/graphql` and `/graphiql` endpoints</span>
GraphQL(app, schema=schema)

<span class="hljs-decorator">@app.teardown_appcontext</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shutdown_session</span><span class="hljs-params">(exception=None)</span>:</span>
    db_session.remove()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run()
</code></pre>
<h2>Creating some data</h2>
<pre><code class="language-bash">$ python

&gt;&gt;&gt; from models import engine, db_session, Base, Department, Employee
&gt;&gt;&gt; Base.metadata.create_all(<span class="hljs-built_in">bind</span>=engine)

&gt;&gt;&gt; <span class="hljs-comment"># Fill the tables with some data</span>
&gt;&gt;&gt; engineering = Department(name=<span class="hljs-string">'Engineering'</span>)
&gt;&gt;&gt; db_session.add(engineering)
&gt;&gt;&gt; hr = Department(name=<span class="hljs-string">'Human Resources'</span>)
&gt;&gt;&gt; db_session.add(hr)

&gt;&gt;&gt; peter = Employee(name=<span class="hljs-string">'Peter'</span>, department=engineering)
&gt;&gt;&gt; db_session.add(peter)
&gt;&gt;&gt; roy = Employee(name=<span class="hljs-string">'Roy'</span>, department=engineering)
&gt;&gt;&gt; db_session.add(roy)
&gt;&gt;&gt; tracy = Employee(name=<span class="hljs-string">'Tracy'</span>, department=hr)
&gt;&gt;&gt; db_session.add(tracy)
&gt;&gt;&gt; db_session.commit()
</code></pre>
<h2>Testing our GraphQL schema</h2>
<p>We’re now ready to test the API we’ve built. Let’s fire up the server from the command line.</p>
<pre><code class="language-bash">$ python ./app.py

 * Running on http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">5000</span>/ (Press CTRL+C to quit)
</code></pre>
<p>Go to <a href="http://localhost:5000/graphiql">localhost:5000/graphiql</a> and type your first query!</p>
<pre><code class="language-graphql"><span class="hljs-collection">{
  allEmployees <span class="hljs-collection">{
    edges <span class="hljs-collection">{
      node <span class="hljs-collection">{
        id
        name
        department <span class="hljs-collection">{
          name
        }</span>
      }</span>
    }</span>
  }</span>
}</span>
</code></pre>
</div><a href="https://github.com/graphql-python/graphene/edit/master/docs/pages/docs/sqlalchemy/tutorial.md" class="improve-document-link" data-reactid=".graphene.2.1.1.0.1.1">Edit page</a></div></div><a class="docs-next" href="/docs/sqlalchemy/tips/" data-reactid=".graphene.2.1.1.1"><span data-reactid=".graphene.2.1.1.1.0">Next - </span><span data-reactid=".graphene.2.1.1.1.1">Tips</span><span data-reactid=".graphene.2.1.1.1.2"> →</span></a></div></div></div></div></div><script src="/bundle.js"></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-12613282-7', 'auto');
            ga('send', 'pageview');
            </script></body></html>